<?php
// Fehleranzeige aktivieren
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// Zugriffsschutz (optional)
if (!defined('IN_SCRIPT')) {
    define('IN_SCRIPT', 1);
}

// Konfiguration laden
require_once(__DIR__ . '/../config.php');
//echo "<p>✅ config.php geladen</p>";

// DB-Verbindung herstellen
$conn = get_db_connection();
//echo "<p>✅ DB-Verbindung erfolgreich</p>";

// Tabellennamen aus HESK-Konfiguration
global $hesk_settings;
$table = $hesk_settings['db_hb_pfix'] . 'hallenbuch';
//echo "<p>Tabellenname: <strong>$table</strong></p>";

// SQL-Befehl
$sql = "SELECT * FROM $table ORDER BY id DESC LIMIT 10";
//echo "<pre>SQL: $sql</pre>";

// Query ausführen
$result = mysqli_query($conn, $sql);

if (!$result) {
    echo "<p>❌ SQL-Fehler: " . mysqli_error($conn) . "</p>";
    mysqli_close($conn);
    exit;
}

// Einträge anzeigen
echo "<h3>Letzte Einträge:</h3>";

if (mysqli_num_rows($result) > 0) {
    // Spaltennamen dynamisch ermitteln
    $fields = array_keys(mysqli_fetch_assoc($result));
    mysqli_data_seek($result, 0); // Zeiger zurücksetzen

    echo "<table border='1' cellpadding='5' cellspacing='0'>";
    echo "<tr>";
    foreach ($fields as $field) {
        echo "<th>$field</th>";
    }
    echo "</tr>";

    while ($row = mysqli_fetch_assoc($result)) {
        echo "<tr>";
        foreach ($fields as $field) {
            echo "<td>{$row[$field]}</td>";
        }
        echo "</tr>";
    }

    echo "</table>";
} else {
    echo "<p>⚠️ Keine Einträge gefunden.</p>";
}

mysqli_close($conn);

