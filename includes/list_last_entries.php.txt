<?php
require_once(__DIR__ . '/../config.php');

$conn = get_db_connection();

global $hesk_settings;
$table = $hesk_settings['db_hb_pfix'] . 'hallenbuch';

#$sql = "SELECT * FROM $table ORDER BY id DESC LIMIT 10";
$sql = "SELECT * FROM $table ORDER BY datum DESC, von DESC LIMIT 10";

$result = mysqli_query($conn, $sql);

if ($result && mysqli_num_rows($result) > 0) {
// Tabelle ausgeben
echo '<style>
    table.last-entries {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        margin-top: 10px;
    }
    table.last-entries th, table.last-entries td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: left;
        overflow-wrap: break-word;
        vertical-align: top;
    }
    table.last-entries th.bemerkung,
    table.last-entries td.bemerkung {
        width: 300px;
        max-width: 400px;
    }
</style>';

echo '<h2>Letzte Einträge:</h2>';
echo '<table class="last-entries">';
echo '<tr>
        <th>Datum</th>
        <th>Von</th>
        <th>Bis</th>
        <th>Gruppe</th>
        <th>Leiter</th>
        <th>Vermerk</th>
        <th class="bemerkung">Bemerkung</th>
      </tr>';

while ($row = mysqli_fetch_assoc($result)) {
    echo '<tr>
            <td>' . date('d.m.Y', strtotime($row['datum'])) . '</td>
            <td>' . htmlspecialchars($row['von']) . '</td>
            <td>' . htmlspecialchars($row['bis']) . '</td>
            <td>' . htmlspecialchars($row['gruppe']) . '</td>
            <td>' . htmlspecialchars($row['leiter']) . '</td>
            <td>' . htmlspecialchars($row['vermerk']) . '</td>
            <td class="bemerkung">' . nl2br(htmlspecialchars($row['bemerkung'])) . '</td>
          </tr>';
}

echo '</table>';
} else {
    echo "<p>Keine Einträge gefunden.</p>";
}

mysqli_close($conn);

