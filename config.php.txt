<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

if (!defined('IN_SCRIPT')) {
    define('IN_SCRIPT', 1); // HESK erwartet diese Konstante
}
// HESK-Konfiguration einbinden
require_once '/srv/hesk_settings.inc.php';

// Hallenbuch-spezifischer Tabellenprefix
$hesk_settings['db_hb_pfix'] = 'hb_';

// Datenbankverbindung bereitstellen
function get_db_connection(): PDO {
    global $hesk_settings;

    $dsn = "mysql:host={$hesk_settings['db_host']};dbname={$hesk_settings['db_name']};charset=utf8mb4";
    $options = [
        PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
    ];

    return new PDO($dsn, $hesk_settings['db_user'], $hesk_settings['db_pass'], $options);
}
if (!function_exists('get_db_connection')) {
    function get_db_connection(): mysqli {
        global $hesk_settings;

        $conn = mysqli_connect(
            $hesk_settings['db_host'],
            $hesk_settings['db_user'],
            $hesk_settings['db_pass'],
            $hesk_settings['db_name']
        );

        if (!$conn) {
            echo "<p>‚ùå DB-Verbindung fehlgeschlagen: " . mysqli_connect_error() . "</p>";
            exit;
        }

        return $conn;
    }
}

